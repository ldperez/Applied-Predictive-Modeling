---
title: "ADS503_UPham_team5"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
**Column Descriptions**
HeartDisease: Respondents that have ever reported having coronary heart disease (CHD) or myocardial infarction (MI).
BMI: Body Mass Index (BMI).
Smoking: Have you smoked at least 100 cigarettes in your entire life?
AlcoholDrinking: Heavy drinkers (adult men having more than 14 drinks per week and adult women having more than 7 drinks per week
Stroke: (Ever told) (you had) a stroke?
PhysicalHealth: Now thinking about your physical health, which includes physical illness and injury, for how many days during the past 30 days was your physical health not good? (0-30 days).
MentalHealth: Thinking about your mental health, for how many days during the past 30 days was your mental health not good? (0-30 days).
DiffWalking: Do you have serious difficulty walking or climbing stairs?
Sex: Are you male or female?
AgeCategory: Fourteen-level age category. (then calculated the mean)
Race: Imputed race/ethnicity value.
Diabetic: (Ever told) (you had) diabetes?
PhysicalActivity: Adults who reported doing physical activity or exercise during the past 30 days other than their regular job.
GenHealth: Would you say that in general your health is...
SleepTime: On average, how many hours of sleep do you get in a 24-hour period?
Asthma: (Ever told) (you had) asthma?
KidneyDisease: Not including kidney stones, bladder infection or incontinence, were you ever told you had kidney disease?
SkinCancer: (Ever told) (you had) skin cancer?

```{r}
library(ggplot2)
library(lattice)
library(caret)
library(e1071)
data(tecator)
library(survival)
library(Hmisc)
library(corrplot)
```


```{r}
heart <- read.csv("heart.csv")
str(heart)
```

### Missing data

```{r}
colSums(is.na(heart))
```

**--> There is no missing data ** 

### Duplicates

```{r}
sum(duplicated(heart))
```

```{r}
dup <- heart[duplicated(heart),]
head(dup)
```

```{r}
#check the balance in roiginal data and in duplicates
table(heart$HeartDisease)
table(dup$HeartDisease)
```

```{r}
27373 /(27373 + 292422 )*100
112 /(112+17966) *100
```

**There are no IDs to identify whether these duplicates are real, but re the chances of duplicates are low. Plus the duplicates even add more imbalance to the whole data --> it's better to removed them.**

```{r}
#Remove duplicates
heartRedRow <- unique(heart)
dim(heartRedRow)
```

### Convert catergorical data to factors

```{r}
unique(heartRedRow$AgeCategory)
unique(heartRedRow$GenHealth)
```


```{r}
#Convert Ordinal category variable into factors with order using label-coding
heartRedRow$AgeCategory <- factor(heartRedRow$AgeCategory, ordered = TRUE)
heartRedRow$GenHealth   <- factor(heartRedRow$GenHealth, 
                            levels = c("Poor", "Fair", "Good", 
                                       "Very good", "Excellent"),
                            ordered = TRUE)

#Check the conversion order
min(heartRedRow$AgeCategory)
min(heartRedRow$GenHealth)

```

```{r}
# get the column names with character type (nominal category)
catColName <- sapply(heartRedRow, is.character)
#catColName <- colnames(heartRedRow %>% select_if(is.character))
# Apply label-coding for the character columns 
heartRedRow[, catColName] <- lapply(heartRedRow[, catColName], factor)
str(heartRedRow)
```

```{r}
# Create data frame for independent and dependent variables
heartRedRowX <- subset(heartRedRow, select = -HeartDisease)
heartRedRowY <- subset(heartRedRow, select = HeartDisease)
head(heartRedRowX) 
```

```{r}
#Get Column with factor type except response variable
toConvert <- sapply(heartRedRowX, is.factor)
#Display numeric values of factor variables
heartRedRowX[, toConvert] <- sapply(heartRedRowX[, toConvert], unclass)
str(heartRedRowX)
```

```{r fig.width=2, fig.height=1}
barchart(heartRedRowY)
```


```{r  fig.width=3, fig.height=2} 
#barplot(table(heart$HeartDisease),  xlab= "Heart Disease", ylab= "Frequncy", main="Distribution of Hear Disease Status" ) 
```

### Training/Test split

**Since the some of the columns are very imbalance including the response variables. stratified split would be use to ensure similar distribution of classes in both training and test sets.**

```{r plitting data}
set.seed(100)
# Create random stratified sample splits 
trainingRows <- createDataPartition(heartRedRowY$HeartDisease, p = .8, list = FALSE)
#subset the data into object for training using
trainX <- heartRedRowX[trainingRows,]
trainY <- heartRedRowY[trainingRows,]
trainY <- as.data.frame(trainY)
#subset the data into object for test using
testX <- heartRedRowX[-trainingRows,]
testY <- heartRedRowY[-trainingRows,]
testY <- as.data.frame(testY)
dim(testY)
dim(testX)
```

### Explore data in training set

```{r}
summary(trainX)
```


```{r, some histogram}
# some histograms
par(mfrow = c(1,3))
hist(trainX$BMI)
hist(trainX$PhysicalHealth)
hist(trainX$SleepTime)
```


```{r} 
hist.data.frame(trainX)
```

### Check for highly correalted predictors

```{r highly correlated predicotrs}
correlations <- cor(trainX)
highCorr <- findCorrelation(correlations, cutoff = .75) 
length(highCorr)
```

```{r correaltion heatmap}
#Create correlation matrix
heartTrainCor = cor(trainX)
#plot cor matrix
corrplot(heartTrainCor, method="color", addCoef.col= 1, number.cex = 0.4)
```
**-> correlations are in reasonable range**

### Check realtionship of independent variables and dependent variable

```{r}
#Compare Race with Heart disease overlayed
par(mfrow = c(1,2))
ggplot(trainX, aes(Race)) + geom_bar(aes(fill = trainY$trainY))
ggplot(trainX, aes(Race)) + geom_bar(aes(fill = trainY$trainY), position = "fill")

```


```{r}
#Compare SleepTime with Heart disease overlayed
par(mfrow = c(1,2))
ggplot(trainX, aes(SleepTime)) + geom_bar(aes(fill = trainY$trainY))
ggplot(trainX, aes(SleepTime)) + geom_bar(aes(fill = trainY$trainY), position = "fill")
```


**-> sleep time should be cut to 1-16hr is more reasonabl

```{r}
#trainX[trainX$SleepTime >= 16]
#Or
sleepOutlier <- subset(trainX, trainX$SleepTime > 16 | trainX$SleepTime < 4 )
sleepOutlier
# To drop the row
```


```{r}
#Compare Age with Heart disease overlayed
par(mfrow = c(1,2))
ggplot(trainX, aes(AgeCategory)) + geom_bar(aes(fill = trainY$trainY))
ggplot(trainX, aes(AgeCategory)) + geom_bar(aes(fill = trainY$trainY), position = "fill")
```

```{r}
#Compare Stroke with Heart disease overlayed
par(mfrow = c(1,2))
ggplot(trainX, aes(Stroke)) + geom_bar(aes(fill = trainY$trainY))
ggplot(trainX, aes(Stroke)) + geom_bar(aes(fill = trainY$trainY), position = "fill")
```

```{r}
#Compare KidneyDisease with Heart disease overlayed
par(mfrow = c(1,2))
ggplot(trainX, aes(KidneyDisease)) + geom_bar(aes(fill = trainY$trainY))
ggplot(trainX, aes(KidneyDisease)) + geom_bar(aes(fill = trainY$trainY), position = "fill")
```

```{r}
#Compare Sleep with MentalHealth overlayed
par(mfrow = c(1,3))
hist(trainX$MentalHealth)
hist(trainX$SleepTime)
hist(trainX$PhysicalHealth)
```
```{r}
trainX[trainX$MentalHealth >= 20,]
```

```{r}
trainX[trainX$PhysicalHealth >= 20,]
```


```{r}
# BMI distribution

hist(trainX$BMI)

```
### Check for zero variance predictors

```{r}
degeneratecols <- nearZeroVar(trainX)
degeneratecols
colnames(trainX[degeneratecols])
```

## Build Classification models

**Logistic Regression **



```{r}
set.seed(100)
ctrl <- trainControl(method = ("cv", number=5),
                     summaryFunction = twoClassSummary,
                     classProbs = TRUE,
                     savePredictions = TRUE)
```

```{r}
set.seed(100)
lrFit<- train(x = trainX, 
               y = trainY$trainY,
               method = "glm",
               metric = "ROC",
               trControl = ctrl)

#lrFit3
testResults <- data.frame(obs = testY,
                          LR = predict(lrFit, testX))
```


```{r}
lrFit
```


```{r}
set.seed(100)
ldaFit <- train(x = trainX, 
                y = trainY$trainY,
                method = "lda",
                preProc = c("center","scale"),
                metric = "ROC",
                trControl = ctrl)

testResults$LDA <- predict(ldaFit, testX)
```

**Linear Discriminant Analysis ** 

```{r}
ldaFit
```

**Penalized Logistic Regression **

```{r}
glmnGrid <- expand.grid(alpha = c(0,  .1,  .2, .4, .6, .8, 1),
                        lambda = seq(.01, .2, length = 10))
set.seed(100)
glmnFit <- train(x = trainX, 
                 y = trainY$trainY,
                 method = "glmnet",
                 tuneGrid = glmnGrid,
                 preProc = c("center", "scale"),
                 metric = "ROC",
                 trControl = ctrl)
#glmnFit
testResults$glmnet <- predict(glmnFit, testX)
```


```{r}
glmnFit
```


```{r}
set.seed(100)
nscFit <- train(x = trainX, 
                y = trainY$trainY,
                method = "pam",
                preProc = c("center", "scale"),
                tuneGrid = data.frame(threshold = seq(0, 25, length = 30)),
                metric = "ROC",
                trControl = ctrl)

testResults$NSC <- predict(nscFit, testX)
```


```{r}
nscFity
```

**Mixture Discriminant Analysis**

```{r}
set.seed(100)

mdaFit <- train(x = trainX, 
               y = trainY$trainY,
               method = "mda",
               tuneGrid = expand.grid(subclasses=1:3),
               metric = "ROC",
               trControl = ctrl)
mdaFit
```


```{r}

```


```{r}
set.seed(100)

nnetGrid <- expand.grid(size=1:3, decay=c(0,0.1,0.2,0.3,0.4,0.5,1,2))

nnetFit <- train(x = trainX, 
                y = trainY$trainY,
                method = "nnet",
                tuneGrid = nnetGrid,
                metric = "ROC",
                trace = FALSE, 
                maxit = 100, 
                trControl = ctrl)

```


```{r}
nnetFit
```


```{r}
sigmaEst <- kernlab::sigest(as.matrix(trainX))
svmgrid <- expand.grid(sigma = sigmaEst, C = 2^seq(-4,+4))

set.seed(100)
svmRFit <- train(x = trainX, 
                y = trainY$trainY,
                method = "svmRadial",
                tuneGrid = svmgrid,
                metric = "ROC",
                trControl = ctrl)

```


```{r}
svmRFit
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```

